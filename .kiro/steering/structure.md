# Project Structure & Organization

## Root Directory Structure
```
├── .kiro/                    # Kiro AI assistant configuration
├── src/                      # Main application source code
├── scripts/                  # Database and utility scripts
├── public/                   # Static assets (auto-generated by Next.js)
├── .next/                    # Next.js build output (auto-generated)
├── node_modules/             # Dependencies (auto-generated)
├── package.json              # Project dependencies and scripts
├── next.config.js            # Next.js configuration
├── tailwind.config.js        # Tailwind CSS configuration
├── tsconfig.json             # TypeScript configuration
├── schema.sql                # Database schema definition
├── wrangler.toml             # Cloudflare Workers/D1 configuration
└── docker-compose.yml        # Local development environment
```

## Source Code Organization (`src/`)

### Application Structure (`src/app/`)
Next.js 14 App Router structure with route-based organization:
```
src/app/
├── layout.tsx               # Root layout with providers
├── page.tsx                 # Home page
├── globals.css              # Global styles and CSS variables
├── auth.config.js           # NextAuth configuration
├── api/                     # API routes
│   ├── auth/[...nextauth]/  # Authentication endpoints
│   ├── templates/           # Template CRUD operations
│   ├── users/               # User management
│   └── search/              # Search functionality
├── gallery/                 # Public template gallery
├── mine/                    # User's personal templates
├── profile/                 # User profile management
├── settings/                # Application settings
├── signin/                  # Authentication pages
└── templates/               # Template management pages
    ├── gallery/             # Browse public templates
    ├── mine/                # Manage personal templates
    └── page.tsx             # Template overview
```

### Component Architecture (`src/components/`)
Organized by feature and reusability:
```
src/components/
├── ui/                      # Base UI components (Shadcn/ui)
│   ├── button.tsx           # Button variants
│   ├── card.tsx             # Card layouts
│   ├── dialog.tsx           # Modal dialogs
│   ├── input.tsx            # Form inputs
│   └── ...                  # Other base components
├── auth-provider.tsx        # Authentication context
├── navigation.tsx           # Main navigation component
├── template-card.tsx        # Template display card
├── template-manager.tsx     # Template CRUD interface
├── template-visualization.tsx # Template flow diagrams
├── create-template-dialog.tsx # Template creation modal
├── query-provider.tsx       # React Query setup
└── theme-provider.tsx       # Dark/light theme management
```

### Business Logic (`src/lib/`)
Core utilities and database operations:
```
src/lib/
├── database.ts              # Database query helpers and ORM-like functions
├── auth-helper.ts           # Authentication utilities
└── utils.ts                 # General utility functions (cn, formatters, etc.)
```

### API Services (`src/services/`)
External service integrations:
```
src/services/
├── api.ts                   # HTTP client and API helpers
└── local-storage.ts         # Browser storage utilities
```

### Type Definitions (`src/types/`)
Comprehensive TypeScript interfaces:
```
src/types/
└── index.ts                 # All type definitions for the application
```

## Configuration Files

### TypeScript Configuration
- **Path Aliases**: `@/` maps to `./src/` for clean imports
- **Strict Mode**: Enabled for type safety
- **Module Resolution**: Bundler mode for Next.js compatibility

### Database Structure
- **Primary Database**: Cloudflare D1 (SQLite) with schema in `schema.sql`
- **Tables**: users, templates, template_parameters, mcp_servers, template_tags, etc.
- **Full-Text Search**: Virtual FTS5 table for template search
- **Relationships**: Foreign keys with cascade deletes where appropriate

### Styling Architecture
- **Global Styles**: `src/app/globals.css` with CSS custom properties
- **Component Styles**: Tailwind utility classes with design system tokens
- **Theme System**: CSS variables for light/dark mode support
- **Design Tokens**: Consistent spacing, colors, and typography scales

## File Naming Conventions

### Components
- **React Components**: PascalCase (e.g., `TemplateCard.tsx`)
- **Page Components**: lowercase with hyphens (e.g., `template-card.tsx`)
- **Utility Files**: kebab-case (e.g., `auth-helper.ts`)

### API Routes
- **REST Endpoints**: Follow Next.js App Router conventions
- **Dynamic Routes**: Square brackets (e.g., `[id]/route.ts`)
- **Catch-all Routes**: Triple dots (e.g., `[...nextauth]/route.ts`)

### Database
- **Table Names**: snake_case (e.g., `template_parameters`)
- **Column Names**: snake_case (e.g., `created_at`, `user_id`)
- **Index Names**: Prefixed with `idx_` (e.g., `idx_templates_user_id`)

## Import Organization
Standard import order:
1. React and Next.js imports
2. Third-party library imports
3. Internal component imports (using `@/` alias)
4. Type-only imports (with `type` keyword)
5. Relative imports (if any)

## Data Flow Patterns

### State Management
- **Server State**: TanStack React Query for API data
- **Client State**: Zustand for UI state and user preferences
- **Form State**: React Hook Form with Zod validation
- **Authentication State**: NextAuth.js session management

### Component Communication
- **Props**: For parent-child data flow
- **Context**: For deeply nested shared state (auth, theme)
- **Custom Hooks**: For reusable stateful logic
- **Event Callbacks**: For child-to-parent communication

### Database Access Patterns
- **Query Classes**: Organized by entity (UserQueries, TemplateQueries, etc.)
- **Prepared Statements**: All queries use parameter binding
- **JSON Columns**: Complex data stored as JSON with proper typing
- **Transactions**: Used for multi-table operations

## Development Workflow
1. **Feature Branches**: Create from main for new features
2. **Component Development**: Start with types, then UI, then logic
3. **Database Changes**: Update schema.sql and migration scripts
4. **Testing**: Unit tests for utilities, integration tests for API routes
5. **Type Safety**: Ensure all components and functions are properly typed